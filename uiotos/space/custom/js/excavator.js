!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.gx=e()}(this,function(){"use strict";var r,L={flyToView:function(e,t,n,i){var o=ht.Default.clone(e.getEye()),a=ht.Default.clone(e.getCenter()),r=t[0]-o[0],s=t[1]-o[1],d=t[2]-o[2],h=n[0]-a[0],u=n[1]-a[1],c=n[2]-a[2];ht.Default.startAnim({duration:3e3,easing:function(t){return t},finishFunc:function(){"function"==typeof i&&i()},action:function(t){e.setEye([o[0]+r*t,o[1]+s*t,o[2]+d*t]),e.setCenter([a[0]+h*t,a[1]+u*t,a[2]+c*t])}})},setSkyBox:function(t,e){var n=new ht.Node;n.s3([100,100,100]),n.setTag("sky"),n.s({shape3d:"sphere","shape3d.blend":"rgb(71,71,71)","shape3d.color":"#DDDDDD","shape3d.image":e,"shape3d.reverse.flip":!0}),t.setSkyBox(n)},blurBackground:function(t,e){this.opacityMap||(this.opacityMap={});var n=.1,i=this.opacityMap;t.each(function(t){if(i[t.getId()]||(i[t.getId()]={"shape3d.opacity":t.s("shape3d.opacity"),"shape3d.transparent":t.s("shape3d.transparent"),"all.opacity":t.s("all.opacity"),"all.transparent":t.s("all.transparent"),"left.opacity":t.s("left.opacity"),"left.transparent":t.s("left.transparent"),"right.opacity":t.s("right.opacity"),"right.transparent":t.s("right.transparent"),"front.opacity":t.s("front.opacity"),"front.transparent":t.s("front.transparent"),"back.opacity":t.s("back.opacity"),"back.transparent":t.s("back.transparent"),"top.opacity":t.s("top.opacity"),"top.transparent":t.s("top.transparent"),"bottom.opacity":t.s("bottom.opacity"),"bottom.transparent":t.s("bottom.transparent"),"3d.selectable":t.s("3d.selectable")}),e instanceof Array){if(-1<e.indexOf(t))return}else if(t===e||!t.s("3d.selectable"))return;t.s({"shape3d.opacity":n,"shape3d.transparent":!0,"all.opacity":n,"all.transparent":!0,"left.opacity":n,"left.transparent":!0,"right.opacity":n,"right.transparent":!0,"front.opacity":n,"front.transparent":!0,"back.opacity":n,"back.transparent":!0,"top.opacity":n,"top.transparent":!0,"bottom.opacity":n,"bottom.transparent":!0,"3d.selectable":!1})})},restoreBackground:function(t){var e=this.opacityMap;t.each(function(t){t.s(e[t.getId()])})},getCircleIntersectionPoints:function(t,e,n,i,o,a){var r,s,d,h,u,c,v,l,m;return s=i-t,d=o-e,!(n+a<(h=Math.sqrt(d*d+s*s)))&&(!(h<Math.abs(n-a))&&(m=e+d*(r=(n*n-a*a+h*h)/(2*h))/h,[{x:(l=t+s*r/h)+(c=(u=Math.sqrt(n*n-r*r))/h*-d),y:m+(v=s*(u/h))},{x:l-c,y:m-v}]))},getNodeMat:function(t,e){return t.getData3dUI(e).validate(),e.mat},toWorldPosition:function(t,e,n){var i=ht.Math.Vector3,o=ht.Math.Matrix4;return new i(n).applyMatrix4((new o).fromArray(this.getNodeMat(t,e))).toArray()},toLocalPostion:function(t,e,n){var i=ht.Math.Matrix4,o=ht.Math.Vector3,a=(new i).fromArray(this.getNodeMat(t,e)),r=(new i).getInverse(a);return new o(n).applyMatrix4(r).toArray()},getRelativeRotation:function(t,e,n){var i=ht.Math.Matrix4,o=(new i).fromArray(this.getNodeMat(t,n)),a=(new i).getInverse(o),r=(new i).fromArray(this.getNodeMat(t,e)),s=(new i).extractRotation(a.multiply(r)),d=new ht.Math.Euler(0,0,0,e.getRotationMode(),!0);return d.setFromRotationMatrix(s),d.x},applyRelativeRotation:function(t,e,n){var i=e.r3(),o=new ht.Math.Euler(i[0],i[1],i[2],e.getRotationMode(),!0),a=(new ht.Math.Quaternion).setFromEuler(o),r=new ht.Math.Euler(n,0,0,t.getRotationMode(),!0),s=(new ht.Math.Quaternion).setFromEuler(r);a.multiply(s);var d=new ht.Math.Euler(0,0,0,t.getRotationMode(),!0).setFromQuaternion(a);t.r3(d.x,d.y,d.z)}};ht.Math.Vector2.prototype.cross||(ht.Math.Vector2.prototype.cross=function(t){return this.x*t.y-this.y*t.x}),ht.Math.Matrix4.prototype.extractRotation||(ht.Math.Matrix4.prototype.extractRotation=function(t){void 0===r&&(r=new ht.Math.Vector3),void 0===t&&(t=new ht.Math.Matrix4);var e=this.el,n=t.el,i=1/r.setFromMatrixColumn(t,0).length(),o=1/r.setFromMatrixColumn(t,1).length(),a=1/r.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,this}),ht.Math.Matrix4.prototype.makeRotationFromQuaternion||(ht.Math.Matrix4.prototype.makeRotationFromQuaternion=function(t){var e=this.el,n=t._x,i=t._y,o=t._z,a=t._w,r=n+n,s=i+i,d=o+o,h=n*r,u=n*s,c=n*d,v=i*s,l=i*d,m=o*d,f=a*r,p=a*s,y=a*d;return e[0]=1-(v+m),e[4]=u-y,e[8]=c+p,e[1]=u+y,e[5]=1-(h+m),e[9]=l-f,e[2]=c-p,e[6]=l+f,e[10]=1-(h+v),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}),ht.Math.Vector3.prototype.setFromMatrixColumn||(ht.Math.Vector3.prototype.setFromMatrixColumn=function(t,e){return this.fromArray(t.el,4*e)}),ht.Math.Quaternion.prototype.multiply||(ht.Math.Quaternion.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)}),ht.Math.Quaternion.prototype.multiplyQuaternions||(ht.Math.Quaternion.prototype.multiplyQuaternions=function(t,e){var n=t._x,i=t._y,o=t._z,a=t._w,r=e._x,s=e._y,d=e._z,h=e._w;return this._x=n*h+a*r+i*d-o*s,this._y=i*h+a*s+o*r-n*d,this._z=o*h+a*d+n*s-i*r,this._w=a*h-n*r-i*s-o*d,this});!function(){function h(t){this.value=t}function t(o){var a,r;function s(t,e){try{var n=o[t](e),i=n.value;i instanceof h?Promise.resolve(i.value).then(function(t){s("next",t)},function(t){s("throw",t)}):d(n.done?"return":"normal",n.value)}catch(t){d("throw",t)}}function d(t,e){switch(t){case"return":a.resolve({value:e,done:!0});break;case"throw":a.reject(e);break;default:a.resolve({value:e,done:!1})}(a=a.next)?s(a.key,a.arg):r=null}this._invoke=function(i,o){return new Promise(function(t,e){var n={key:i,arg:o,resolve:t,reject:e,next:null};r?r=r.next=n:(a=r=n,s(i,o))})},"function"!=typeof o.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(t){return this._invoke("next",t)},t.prototype.throw=function(t){return this._invoke("throw",t)},t.prototype.return=function(t){return this._invoke("return",t)}}();var e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),w=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){o=!0,a=t}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=function(){function t(){e(this,t),this.mi2dEventArray=[],this.mi3dEventArray=[],this.mp2dEventArray=[],this.mp3dEventArray=[]}return n(t,[{key:"init2dScreen",value:function(t,e){var n=this.g3d,i=this.dm2d=new ht.DataModel,o=this.g2d=new ht.graph.GraphView(i),a=o.getView();if(a.style.left="0",a.style.right="0",a.style.top="0",a.style.bottom="0",o.getSelectWidth=function(){return 0},o.handleScroll=function(){},o.handlePinch=function(){},o.setPannable(!1),o.setRectSelectable(!1),o.setScrollBarVisible(!1),o.setMovableFunc(function(){return!1}),n?n.getView().appendChild(o.getView()):document.body.appendChild(o.getView()),t){var r=t.downListener,s=t.moveListener,d=t.upListener,h=t.wheelListener,u=t.commonListener;u&&(this.commonListener=u,a.addEventListener("mousedown",this.commonListener.bind(this,o)),a.addEventListener("mousemove",this.commonListener.bind(this,o)),a.addEventListener("mouseup",this.commonListener.bind(this,o)),a.addEventListener("touchstart",this.commonListener.bind(this,o)),a.addEventListener("touchmove",this.commonListener.bind(this,o)),a.addEventListener("touchend",this.commonListener.bind(this,o))),r&&(this.downListener=r,a.addEventListener("mousedown",this.downListener.bind(this,o)),a.addEventListener("touchstart",this.downListener.bind(this,o))),s&&(this.moveListener=s,a.addEventListener("mousemove",this.moveListener.bind(this,o)),a.addEventListener("touchmove",this.moveListener.bind(this,o))),d&&(this.upListener=d,a.addEventListener("mouseup",this.upListener.bind(this,o)),a.addEventListener("touchend",this.upListener.bind(this,o))),h&&(this.wheelListener=h,a.addEventListener("mousewheel",this.wheelListener.bind(this,o)))}this.g2dResizeListener=function(t){o.fitContent(!1,0),o.iv()},window.addEventListener("resize",this.g2dResizeListener),"function"==typeof e&&e(o,i)}},{key:"init3dScreen",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,e=arguments[1],n=this.dm3d=new ht.DataModel,i=this.g3d=new ht.graph3d.Graph3dView(n),o=i.getView(),a=o.style;a.left="0",a.right="0",a.top="0",a.bottom="0",t.appendChild(o),this.g3dResizeListener=function(t){i.iv()},window.addEventListener("resize",this.g3dResizeListener),"function"==typeof e&&e(i,n)}},{key:"load2dScreen",value:function(t,e,n){var i=this.dm2d,o=this.g2d;if(i.clear(),"function"==typeof e&&e(o,i),"string"==typeof t)ht.Default.xhrLoad(t,function(t){t?(i.deserialize(t),"function"==typeof n&&n(o,i)):console.log("资源加载失败")});else if(t instanceof ht.Data){var a=t;t=null,i.add(a),this.addNodeChilds(a,i),"function"==typeof n&&n(o,i)}}},{key:"load3dScreen",value:function(t,e,o){var a=this,r=this.dm3d,s=this.g3d;if(r.clear(),"function"==typeof e&&e(s,r),"string"==typeof t)ht.Default.xhrLoad(t,function(t){if(t){r.deserialize(t);var e=ht.Default.parse(t),n=ht.Default.clone(e.a),i=a.defaultScene=e.scene;s.setEye(i.eye),s.setCenter(i.center),s.setFar(i.far),s.setNear(i.near),"function"==typeof o&&o(s,r,n)}else console.log("资源加载失败")});else if(t instanceof ht.Data){var n=t;t=null,r.add(n),this.addNodeChilds(n,r),"function"==typeof o&&o(s,r)}}},{key:"reset2dEvent",value:function(t){var e=t.miListener,n=t.umiListener,i=t.mpListener,o=t.umpListener,a=t.scope;e&&this.add2dMiEvent(e,a),n&&this.remove2dMiEvent(n,a),i&&this.add2dMpEvent(i,a),o&&this.remove2dMpEvent(o,a)}},{key:"reset3dEvent",value:function(t){var e=t.miListener,n=t.umiListener,i=t.mpListener,o=t.umpListener,a=t.scope;e&&this.add3dMiEvent(e,a),n&&this.remove3dMiEvent(n,a),i&&this.add3dMpEvent(i,a),o&&this.remove3dMpEvent(o,a)}},{key:"add2dMiEvent",value:function(t,e){var n=this,i=this.g2d,o=this.mi2dEventArray;o.forEach(function(t){n.remove2dMiEvent(t,e)}),-1===o.indexOf(t)&&this.mi2dEventArray.push(t),t&&i.mi(t,e)}},{key:"remove2dMiEvent",value:function(t,e){var n=this.g2d;t&&n.umi(t,e)}},{key:"add3dMiEvent",value:function(t,e){var n=this,i=this.g3d,o=this.mi3dEventArray;o.forEach(function(t){n.remove3dMiEvent(t,e)}),-1===o.indexOf(t)&&this.mi3dEventArray.push(t),t&&i.mi(t,e)}},{key:"remove3dMiEvent",value:function(t,e){var n=this.g3d;t&&n.umi(t,e)}},{key:"add2dMpEvent",value:function(t,e){var n=this,i=this.g2d,o=this.mp2dEventArray;o.forEach(function(t){n.remove2dMpEvent(t,e)}),-1===o.indexOf(t)&&this.mp2dEventArray.push(t),t&&i.mp(t,e)}},{key:"remove2dMpEvent",value:function(t,e){var n=this.g2d;t&&n.ump(t,e)}},{key:"add3dMpEvent",value:function(t,e){var n=this,i=this.g3d,o=this.mp3dEventArray;o.forEach(function(t){n.remove3dMpEvent(t,e)}),-1===o.indexOf(t)&&this.mp3dEventArray.push(t),t&&i.mp(t,e)}},{key:"remove3dMpEvent",value:function(t,e){var n=this.g3d;t&&n.ump(t,e)}},{key:"remove2d",value:function(){var e=this,t=this.g2d,n=this.dm2d,i=this.g3d,o=t.getView();t&&(n.clear(),this.g2dResizeListener&&window.removeEventListener("resize",this.g2dResizeListener),this.commonListener&&(o.removeEventListener("mousedown",this.commonListener),o.removeEventListener("mousemove",this.commonListener),o.removeEventListener("mouseup",this.commonListener),o.removeEventListener("touchstart",this.commonListener),o.removeEventListener("touchmove",this.commonListener),o.removeEventListener("touchend",this.commonListener)),this.downListener&&(o.removeEventListener("mousedown",this.downListener),o.removeEventListener("touchstart",this.downListener)),this.moveListener&&(o.removeEventListener("mousemove",this.moveListener),o.removeEventListener("touchmove",this.moveListener)),this.upListener&&(o.removeEventListener("mouseup",this.upListener),o.removeEventListener("touchend",this.upListener)),this.wheelListener&&o.removeEventListener("mousewheel",this.wheelListener),0<this.mi2dEventArray.length&&(this.mi2dEventArray.forEach(function(t){e.remove2dMiEvent(t)}),this.mi2dEventArray=[]),0<this.mp2dEventArray.length&&(this.mp2dEventArray.forEach(function(t){e.remove2dMpEvent(t)}),this.mp2dEventArray=[]),i?i.getView().removeChild(t.getView()):document.body.removeChild(t.getView()))}},{key:"remove3d",value:function(t){var e=this;this.remove2d(),0<this.mi3dEventArray.length&&(this.mi3dEventArray.forEach(function(t){e.remove3dMiEvent(t)}),this.mi3dEventArray=[]),0<this.mp3dEventArray.length&&(this.mp3dEventArray.forEach(function(t){e.remove3dMpEvent(t)}),this.mp3dEventArray=[]),this.g3dResizeListener&&window.removeEventListener("resize",this.g3dResizeListener);var n=this.g3d;this.dm3d.clear(),t.removeChild(n.getView())}},{key:"destory",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body;this.remove3d(t)}},{key:"addNodeChilds",value:function(t,n){var i=this,e=t.getChildren();e&&0<e.size()&&e.each(function(t){n.add(t);var e=t.getChildren();e&&0<e.size()&&i.addNodeChilds(t,n)})}}]),t}(),t=new(function(){function t(){var h=this;e(this,t);var n=new ht.Notifier,i=this.screen=new o;i.init3dScreen(void 0,function(t){L.setSkyBox(t,"assets/demo/贴图/天空球/简单黄昏3.jpg")}),i.init2dScreen({downListener:function(t,e){t.getDataAt(e)&&(i.g3d.setRotatable(!1),i.g3d.setZoomable(!1))},upListener:function(t,e){var n=h.g3d;!n.isRotatable()&&n.setRotatable(!0),!n.isZoomable()&&n.setZoomable(!0)}}),i.load3dScreen("scenes/挖掘机控制.json",null,function(t,e){h.init3dInteractiveNodes(),i.add3dMiEvent(h.mi3dEvent,h),n.fire({kind:"deserialized"})}),i.load2dScreen(ht.Default.isTouchable?"displays/demo/线上demo/挖机ui移动端.json":"displays/demo/线上demo/挖机ui.json",null,function(t,e){h.init2dInteractiveNodes(),i.add2dMiEvent(h.mi2dEvent,h),n.fire({kind:"deserialized"})}),Object.assign(this,{g2d:i.g2d,g3d:i.g3d,dm2d:i.dm2d,dm3d:i.dm3d}),n.add(function(t){if("deserialized"===t.kind){var e=h.dm2d,n=h.dm3d;if(0<e.size()&&0<n.size()){Object.assign(h,h.excavatorAction());var i=h.boomSlider,o=h.armSlider,a=h.bucketSlider,r=h.rotateBoom,s=h.rotateArm,d=h.rotateBucket;i.a("onChange",function(){r(i.a("ht.value"))}),o.a("onChange",function(){s(o.a("ht.value"))}),a.a("onChange",function(){d(a.a("ht.value"))}),h.keyCodeEvent(),h.goAhead()}}}),window.test=this,window.projectUtil=L}return n(t,[{key:"keyCodeEvent",value:function(){var n=this,t=this.goAhead,e=this.back,o={65:{status:!1,action:this.turnLeft},87:{status:!1,action:t},68:{status:!1,action:this.turnRight},83:{status:!1,action:e},37:{status:!1,action:this.bodyTurnLeft},39:{status:!1,action:this.bodyTurnRight}};setInterval(function(){for(var t in o){var e=o[t],n=e.status,i=e.action;n&&i()}},50),document.addEventListener("keydown",function(t){var e=t.keyCode;o[e]&&(o[e].status=!0),t.stopPropagation(),32===e&&n.excavatorAnimate()},!0),document.addEventListener("keyup",function(t){var e=t.keyCode;o[e]&&(o[e].status=!1),t.stopPropagation()},!0),document.addEventListener("mouseup",function(t){clearInterval(n.mouseInterval)},!0),document.addEventListener("touchend",function(t){clearInterval(n.mouseInterval)},!0)}},{key:"mi2dEvent",value:function(t){var e=t.kind,n=t.data;if("clickData"===e){var i=this.goAhead,o=this.back,a=this.turnLeft,r=this.turnRight,s=this.bodyTurnLeft,d=this.bodyTurnRight,h=n.getDisplayName();"W"===h&&(this.mouseInterval=setInterval(function(){i()},50)),"S"===h&&(this.mouseInterval=setInterval(function(){o()},50)),"A"===h&&(this.mouseInterval=setInterval(function(){a()},50)),"D"===h&&(this.mouseInterval=setInterval(function(){r()},50)),"机身左转"===h&&(this.mouseInterval=setInterval(function(){s()},50)),"机身右转"===h&&(this.mouseInterval=setInterval(function(){d()},50)),"挖掘机动画"===h&&this.excavatorAnimate()}}},{key:"mi3dEvent",value:function(){}},{key:"init2dInteractiveNodes",value:function(){var n=this;this.dm2d.each(function(t){var e=t.getTag();"boomSlider"===e&&(n.boomSlider=t),"armSlider"===e&&(n.armSlider=t),"bucketSlider"===e&&(n.bucketSlider=t)})}},{key:"init3dInteractiveNodes",value:function(){var n=this,t=this.dm3d;ht.Default.setBatchInfo("buildBatch",{transparent:!0,reverseCull:!0,image:"symbols/demo/3d场景用/渐变浅蓝有线.png"}),ht.Default.setBatchInfo("starBatch",{reverseCull:!0}),t.each(function(t){var e=t.getDisplayName();"挖掘机履带"===e&&(n.excavatorCrawlerNode=t),"挖掘机齿轮"===e&&(n.excavatorGearNode=t),"挖掘机机身"===e&&(n.excavatorBodyNode=t),"挖掘机大臂"===e&&(n.excavatorBoomNode=t),"挖掘机小臂"===e&&(n.excavatorArmNode=t),"挖掘机挖斗"===e&&(n.excavatorBucketNode=t),"大臂液压-白"===e&&(n.boomWhite=t),"大臂液压-黑"===e&&(n.boomBlack=t),"小臂液压-白"===e&&(n.armWhite=t),"小臂液压-黑"===e&&(n.armBlack=t),"挖斗液压-白"===e&&(n.bucketWhite=t),"挖斗液压-黑"===e&&(n.bucketBlack=t),"小臂枢纽"===e&&(n.armHinge=t),"挖斗枢纽"===e&&(n.bucketHinge=t),"正方形"===e&&(n.rectNode=t),"楼"===e&&t.s("batch","buildBatch"),"星星"===e&&t.s("batch","starBatch")})}},{key:"excavatorAction",value:function(){var y=this.g3d,g=this.excavatorCrawlerNode,n=this.excavatorBodyNode,i=this.excavatorBoomNode,v=this.excavatorArmNode,l=this.excavatorBucketNode,o=this.boomWhite,a=this.boomBlack,r=this.armWhite,s=this.armBlack,m=this.bucketHinge,f=this.armHinge,p=this.rectNode,E=this.bucketWhite,b=this.bucketBlack,d=Math.PI,h=d/180,t=function(t){var e=g.getPosition3d(),n=w(e,3),i=n[0],o=n[1],a=n[2],r=y.getEye(),s=w(r,3),d=s[0],h=s[1],u=s[2],c=g.getRotationY(),v=g.s("shape3d.uv.offset")||[0,0],l=5*Math.sin(c),m=5*Math.cos(c),f=[i+t*l,o,a+t*m],p=[d+t*l,h,u+t*m];g.s("shape3d.uv.offset",[v[0],(v[1]-.2*t)%1]),g.p3(f),y.setCenter(f),y.setEye(p)},e=function(t){var e=(g.getRotationY()+t*h)%(2*d);g.setRotationY(e)},u=function(t){var e=(n.getRotationY()+t*h)%(2*d);n.setRotationY(e)};return{goAhead:function(){t(1)},back:function(){t(-1)},turnLeft:function(){e(1)},turnRight:function(){e(-1)},bodyTurnLeft:function(){u(1)},bodyTurnRight:function(){u(-1)},rotateBoom:function(t){i.setRotationX(h*t);var e=L.toWorldPosition(y,i,[-5260019713460018e-21,.05612970988085342,-.282759031819417]);o.lookAtX(a.p3(),"bottom"),a.lookAtX(e,"top")},rotateArm:function(t){L.applyRelativeRotation(v,i,-t);var e=L.toWorldPosition(y,v,[.585-.5,.485,.17-.5]);r.lookAtX(s.p3(),"bottom"),s.lookAtX(e,"top")},rotateBucket:function(t){var e=ht.Math.Vector2;L.applyRelativeRotation(l,v,-t);var n=L.toLocalPostion(y,p,m.p3()),i=L.toLocalPostion(y,p,f.p3()),o=(n[0]+i[0])/2,a=L.getCircleIntersectionPoints(n[1],n[2],5.523366688970123,i[1],i[2],6.151132443005284),r=new e(a[0]),s=new e(a[1]),d=new e({x:n[1],y:n[2]}),h=new e({x:i[1],y:i[2]}),u=0<r.clone().sub(h).cross(d.clone().sub(h))?r:s,c=L.toWorldPosition(y,p,[o,u.x,u.y]);m.lookAtX(c,"front",[0,1,0]),f.lookAtX(c,"bottom"),E.p3(c),E.lookAtX(b.p3(),"top"),b.lookAtX(c,"bottom")}}}},{key:"excavatorAnimate",value:function(){var a=this;if(!this.isAnimate){this.isAnimate=!0;var e=Math.PI/180,n=[0,30],i=[-.31948,1.15],o=[.15572,2.98587],t=this.g3d,r=this.excavatorBodyNode,s=this.excavatorBoomNode,d=this.excavatorArmNode,h=this.excavatorBucketNode,u=this.boomSlider,c=this.armSlider,v=this.bucketSlider,l=void 0,m=s.getRotationX()/e,f=-L.getRelativeRotation(t,d,s),p=-L.getRelativeRotation(t,h,d),y=u.a("onChange"),g=c.a("onChange"),E=v.a("onChange");u.a("ht.disabled",!0),c.a("ht.disabled",!0),v.a("ht.disabled",!0);var b=[];1<Math.abs(m-n[1])&&b.push({action:function(t){v.a("ht.value",p+t*(o[1]-p)),E()}}),f<i[1]&&b.push({action:function(t){c.a("ht.value",f+t*(i[1]-f)),g()}}),p<o[1]&&b.push({action:function(t){u.a("ht.value",m+t*(n[1]-m)),y()}}),b.push({action:function(t){v.a("ht.value",o[1]-(o[1]-o[0])*t),E()},delay:500},{action:function(t){u.a("ht.value",n[1]-(n[1]-n[0])*t),y()}},{action:function(t){void 0===l&&(l=r.getRotationY()/e),r.setRotationY((l+50*t)*e)}},{action:function(t){v.a("ht.value",o[0]+(o[1]-o[0])*t),E()}},{action:function(t){v.a("ht.value",o[1]-(o[1]-o[0])*t),E()},delay:500},{action:function(t){c.a("ht.value",i[1]-(i[1]-i[0])*t),g()}}),0<b.length&&function n(t){var i=t.action,e=t.frames,o=t.interval;ht.Default.startAnim({frames:e||50,interval:o||20,easing:function(t){return t},finishFunc:function(){var t=b.shift();if(t){var e=t.delay;e?setTimeout(function(){n(t)},e):n(t)}else a.isAnimate=!1,u.a("ht.disabled",!1),c.a("ht.disabled",!1),v.a("ht.disabled",!1)},action:function(t,e){i(t)}})}(b.shift())}}}]),t}());return function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}("",{}),t});

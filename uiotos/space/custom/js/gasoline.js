var g=function(){"use strict";function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=(function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}(e,[{key:"init2dScreen",value:function(e,t){var n=this.g3d,i=this.dm2d=new ht.DataModel,s=this.g2d=new ht.graph.GraphView(i),o=s.getView();if(o.style.left="0",o.style.right="0",o.style.top="0",o.style.bottom="0",s.getSelectWidth=function(){return 0},s.handleScroll=function(){},s.handlePinch=function(){},s.setPannable(!1),s.setRectSelectable(!1),s.setScrollBarVisible(!1),s.setMovableFunc(function(){return!1}),n?n.getView().appendChild(s.getView()):document.body.appendChild(s.getView()),e){var r=e.downListener,d=e.moveListener,h=e.upListener,v=e.wheelListener,a=e.commonListener;a&&(this.commonListener=a,o.addEventListener("mousedown",this.commonListener.bind(this,s)),o.addEventListener("mousemove",this.commonListener.bind(this,s)),o.addEventListener("mouseup",this.commonListener.bind(this,s)),o.addEventListener("touchstart",this.commonListener.bind(this,s)),o.addEventListener("touchmove",this.commonListener.bind(this,s)),o.addEventListener("touchend",this.commonListener.bind(this,s))),r&&(this.downListener=r,o.addEventListener("mousedown",this.downListener.bind(this,s)),o.addEventListener("touchstart",this.downListener.bind(this,s))),d&&(this.moveListener=d,o.addEventListener("mousemove",this.moveListener.bind(this,s)),o.addEventListener("touchmove",this.moveListener.bind(this,s))),h&&(this.upListener=h,o.addEventListener("mouseup",this.upListener.bind(this,s)),o.addEventListener("touchend",this.upListener.bind(this,s))),v&&(this.wheelListener=v,o.addEventListener("wheel",this.wheelListener.bind(this,s)))}this.g2dResizeListener=function(e){s.fitContent(!1,0),s.iv()},window.addEventListener("resize",this.g2dResizeListener),"function"==typeof t&&t(s,i)}},{key:"init3dScreen",value:function(e,t){var n=0<arguments.length&&void 0!==e?e:document.body,i=t,s=this.dm3d=new ht.DataModel,o=this.g3d=new ht.graph3d.Graph3dView(s),r=o.getView(),d=r.style;d.left="0",d.right="0",d.top="0",d.bottom="0",n.appendChild(r),this.g3dResizeListener=function(e){o.iv()},window.addEventListener("resize",this.g3dResizeListener),"function"==typeof i&&i(o,s)}},{key:"load2dScreen",value:function(t,e,n){var i=this;"function"==typeof e&&e(s,o);var s=this.g2d,o=this.dm2d;if(o.clear(),"string"==typeof t){var r=function(e){e?(o.deserialize(e),"function"==typeof n&&n(s,o),i.jsonCache[t]=e):console.log("资源加载失败")};this.jsonCache[t]?r(this.jsonCache[t]):ht.Default.xhrLoad(t,r)}}},{key:"load3dScreen",value:function(s,e,o){var r=this,d=this.dm3d,h=this.g3d;if("function"==typeof e&&e(h,d),d.clear(),"string"==typeof s){var t=function(e){if(e){d.deserialize(e);var t=ht.Default.parse(e),n=ht.Default.clone(t.a),i=r.defaultScene=t.scene;h.setEye(i.eye),h.setCenter(i.center),h.setFar(i.far),h.setNear(i.near),"function"==typeof o&&o(h,d,n),r.jsonCache[s]=e}else console.log("资源加载失败")};this.jsonCache[s]?t(this.jsonCache[s]):ht.Default.xhrLoad(s,t)}}},{key:"reset2dEvent",value:function(e){var t=e.miListener,n=e.umiListener,i=e.mpListener,s=e.umpListener,o=e.scope;t&&this.add2dMiEvent(t,o),n&&this.remove2dMiEvent(n,o),i&&this.add2dMpEvent(i,o),s&&this.remove2dMpEvent(s,o)}},{key:"reset3dEvent",value:function(e){var t=e.miListener,n=e.umiListener,i=e.mpListener,s=e.umpListener,o=e.scope;t&&this.add3dMiEvent(t,o),n&&this.remove3dMiEvent(n,o),i&&this.add3dMpEvent(i,o),s&&this.remove3dMpEvent(s,o)}},{key:"add2dMiEvent",value:function(e,t){var n=this.g2d,i=this.mi2dEventInfo;if(i){var s=i.listener,o=i.listenerScope;this.remove2dMiEvent(s,o)}this.mi2dEventInfo={listener:e,listenerScope:t},e&&n.mi(e,t)}},{key:"remove2dMiEvent",value:function(e,t){var n=this.g2d;e&&n.umi(e,t)}},{key:"add3dMiEvent",value:function(e,t){var n=this.g3d,i=this.mi3dEventInfo;if(i){var s=i.listener,o=i.listenerScope;this.remove3dMiEvent(s,o)}this.mi3dEventInfo={listener:e,listenerScope:t},e&&n.mi(e,t)}},{key:"remove3dMiEvent",value:function(e,t){var n=this.g3d;e&&n.umi(e,t)}},{key:"add2dMpEvent",value:function(e,t){var n=this.g2d,i=this.mp2dEventInfo;if(i){var s=i.listener,o=i.listenerScope;this.remove2dMpEvent(s,o)}this.mp2dEventInfo={listener:e,listenerScope:t},e&&n.mp(e,t)}},{key:"remove2dMpEvent",value:function(e,t){var n=this.g2d;e&&n.ump(e,t)}},{key:"add3dMpEvent",value:function(e,t){var n=this.g3d,i=this.mp3dEventInfo;if(i){var s=i.listener,o=i.listenerScope;this.remove3dMpEvent(s,o)}this.mp3dEventInfo={listener:e,listenerScope:t},e&&n.mp(e,t)}},{key:"remove3dMpEvent",value:function(e,t){var n=this.g3d;e&&n.ump(e,t)}},{key:"remove2d",value:function(){var e=this.g2d,t=this.dm2d,n=this.g3d,i=e.getView();e&&(t.clear(),this.g2dResizeListener&&window.removeEventListener("resize",this.g2dResizeListener),this.commonListener&&(i.removeEventListener("mousedown",this.commonListener),i.removeEventListener("mousemove",this.commonListener),i.removeEventListener("mouseup",this.commonListener),i.removeEventListener("touchstart",this.commonListener),i.removeEventListener("touchmove",this.commonListener),i.removeEventListener("touchend",this.commonListener)),this.downListener&&(i.removeEventListener("mousedown",this.downListener),i.removeEventListener("touchstart",this.downListener)),this.moveListener&&(i.removeEventListener("mousemove",this.moveListener),i.removeEventListener("touchmove",this.moveListener)),this.upListener&&(i.removeEventListener("mouseup",this.upListener),i.removeEventListener("touchend",this.upListener)),this.wheelListener&&i.removeEventListener("mousewheel",this.wheelListener),this.mi2dEventInfo&&(this.mi2dEventInfo=null),this.mp2dEventInfo&&(this.mp2dEventInfo=null),n?n.getView().removeChild(e.getView()):document.body.removeChild(e.getView()))}},{key:"remove3d",value:function(e){this.remove2d(),this.mi3dEventInfo&&(this.mi3dEventInfo=null),this.mp3dEventInfo&&(this.mp3dEventInfo=null),this.g3dResizeListener&&window.removeEventListener("resize",this.g3dResizeListener);var t=this.g3d;this.dm3d.clear(),e.removeChild(t.getView())}},{key:"destory",value:function(e){var t=0<arguments.length&&void 0!==e?e:document.body;this.remove3d(t),this.jsonCache=null}}]),e);function e(){v(this,e),this.jsonCache={}}return new function e(){var n=this;v(this,e);var i=this.screen=new a,t=this.appNotifier=new ht.Notifier;i.init3dScreen(),i.init2dScreen({downListener:function(e,t){e.getDataAt(t)&&t.stopPropagation()},wheelListener:function(e,t){e.getDataAt(t)&&t.stopPropagation()}});var s=this.g2d=this.screen.g2d,o=this.g3d=this.screen.g3d,r=void 0,d=void 0,h=void 0;t.add(function(e){var t=e.kind;"load_3d_index"===t?(i.load3dScreen("scenes/中国电信/生产线.json",null,function(e,t){i.add3dMiEvent(function(e){},n)}),o.return):"load_2d_index"===t&&i.load2dScreen("displays/demo/线上demo/北京研究院.json",null,function(e,t){r=t.getDataByTag("toggleButton"),d=t.getDataByTag("flow2d"),h=t.getDataByTag("background")})}),s.dm().md(function(e){"a:type"===e.property&&e.data===r&&(d.s("2d.visible","2d"===e.newValue),h.s("2d.visible","2d"===e.newValue))}),t.fire({kind:"load_3d_index"}),t.fire({kind:"load_2d_index"})}}();
